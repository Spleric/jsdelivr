/*********************************************\
#  Variables -                                #
#----------------------------------------------
# a = array                                   #
# cb = callback
# e = element                                 #
# f = format                                  #
# tmp = Temporary Variable                    #
# v = value                                   #
\*********************************************/

var tmp = {}, cache = {}, nbsp = ' ', dash = '-',
    config = {
      site_name: 'Spleric',
      meta: [{
        theme_color: '#3F51B5',
        apple_mobile_web_app_capable: 'yes',
        apple_mobile_web_app_status_bar_style: 'black-translucent',
        msapplication_navbutton_color: this.theme_color,
        viewport: 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0'
      }]
    };
tmp.views = '/views/templates/';

function Template() {}
Template.prototype = {
  constructor: Template,
  write: function(v) { document.write(v); },
  writef: function(v, f) { document.write('<' + f + '>' + v + '</' + f + '>'); },
  createDiv: function(a) { tmp.div = document.createElement('div'); tmp.div.id = a.id; tmp.div['class'] = a['class']; this.append('body', tmp.div); },
  append: function(e, v) { document.getElementsByTagName(e)[0].appendChild(v); },
  appendTo: function(e, v) { document.getElementById(e).innerHTML = v; },
  load: function(v, cb) { var xhr = new XMLHttpRequest(); xhr.open('GET', v, true); xhr.send(); xhr.onreadystatechange = function (e) { if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) { cb(xhr.responseText); } }  }
}; tpl = new Template();

function Page(details) { this.meta = details.meta[0]; this.checkBrowser(); this.createStructure(); this.loadImages(); }
Page.prototype = {
  constructor: Page,
  setTitle: function(v) { document.title = config.site_name + nbsp + dash + nbsp + v; },
  setMeta: function(tag, v) { tmp.d = document.createElement('meta'); tmp.d.name = tag; tmp.d.content = v; tpl.append('head', tmp.d); },
  checkBrowser: function() { if (document.documentMode < 11) { window.location = '/error/browser' } },
  createStructure: function() {
    this.setTitle(this.meta.title);
    Object.keys(config.meta[0]).forEach(function(key) { Page.prototype.setMeta(key.split('_').join('-'), config.meta[0][key]); });
    tpl.createDiv({ id: 'header' });
    tpl.load(tmp.views + 'header_generic_2', function(data){ tpl.appendTo('header',data); });
    tpl.createDiv({ id: 'footer' });
    tpl.load(tmp.views + 'footer_generic', function(data){ tpl.appendTo('footer',data); });
  },
  loadImages: function() { tmp.i = document.getElementsByTagName('img'); for (var i=0; i < tmp.i.length; i++) { if(tmp.i[i].getAttribute('data-src')) { tmp.i[i].setAttribute('src', tmp.i[i].getAttribute('data-src')); } } }
};

function JSON() {}
JSON.prototype = {
  constructor: JSON,
  parse: function(v) { return true; }
}
